# HTTPとは?

## HTTPとは何か？

クライアントとサーバーが相互に通信する方法を標準化したTCP/IPベースのアプリケーション層の通信プロトコル。
インターネット上でコンテンツのリクエストとレスポンスが送信される方法が定義されている。
アプリケーション層とはクライアントとサーバが通信する方法を標準化した抽象化層。
HTTPのウェルノンポートは80番が使用されHTTPSでは443番が使用される。

## HTTP/0.9

HTTP/9/0はGETメソッドしかないシンプルなプロトコルであった。
クライアントがサーバにWebページへのリクエストは以下のようなものだった。

``` text
GET /index.html
```

サーバはリクエストに対して、HTMLでレスポンスを返してコンテンツが送信されるとすぐに接続を閉じていた。

HTTP/0.9では`<isindex>`タグを使用することでテキストの入力欄を表示させて「フォーム」と「検索」をおこなうことができた。
`<isindex>`タグを使用するとURLの末尾に`?`と単語(区切り文字は+)をつけてリクエストが送信される。
サーバは送られてきたリクエストを処理してクライアントにHTML作成せてレスポンスを送信する。

HTTP/0.9の時点では現在のHTTPと違い以下のような違いがあった。

- 一度の通信で1つのドキュメントしか送信することができない
- レスポンスとして、HTML以外のコンテンツを送ることができない
- 新しい文書の送信, 更新, 削除を行うことができない
- ステータスコードがないためリクエストやレスポンスが正しく行ったかを知ることができない

## HTTP/1.0

HTML/1.0ではHTMLでの応答以外にも画像, ビデオ, プレーンテキストなどさまざまなコンテンツタイプへの応答形式に対応できるようになった。
さらに、メソッドにもPOSTやHEADなどのメソッドが追加され、応答結果を識別するステータスコードが追加された。
他にもまる日パートタイプやキャッシュ, 認証, コンテンツエンコーディングなどさまざまな要素が追加された。
クライアントは、以下のようなさまざまな情報を含めてリクエストを送信できるようになった。

``` text
GET / HTTP/1.0
Host: example
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)
Accept: */*
```

サーバからのレスポンスでは以下のように最初にステータスコードが記述される。
`Content-Type`によってサーバはクライアントにHTTP以外の任意のファイルを返却することができるようになっている。

``` text
HTTP/1.0 200 OK
Content-Type: text/plain
Content-Length: 137582
Expires: Thu, 05 Dec 2024 16:00:00 GMT
Last-Modified: Wed, 5 August 2024 15:55:28 GMT
Server: Apache 0.84

(response body)
(connection closed)
```

HTTP/1.0は、HTTP/0.9と比べ大きな進化をしているが大きな欠点がある。
それは、1つの接続で１つのリクエストしか行うことができないことである。
そのため、クライアントはサーバから何かしらのコンテンツが必要となると、新しいTCP接続を開きコンテンツを取得しなければならない。
取得するコンテンツの数が多いほど、新しいTCP接続を開く数も増える(3ウェイハンドシェイクを行う必要がある)ためパフォーマンスが大幅に低下してしまう。

### 3way handshake

TCPではクライアントとサーバ間でデータのやり取りを開始するときに以下のような手順をを行っている。

1. クライアントからサーバに対してのアクセス要求
2. サーバからの接続OKという応答
3. データを送信する

## HTTP/1.1

以下のような改善が行われた。

### 新しいメソッドの追加

PUT, PATCH, OPTIONS, DELETEメソッドが追加された。

### ホスト名の必須か

HTTP/1.0まではHost Headerが必須でなかったが、HTTP/1.1では必須になった。

### 持続的な接続

HTTP/1.0では、接続のごとに1つのリクエストしか送信することができなかったため、パフォーマンスの低下や遅延が発生していた。
HTTP/1.1では接続がデフォルトで閉じられなくなり、リクエストヘッダーで`Connection: close`を送信することができた。
クライアントは`Connection: close`を使用することで接続を安全に閉じることができる。

### パイプライン化

クライアントは、同じサーバからのレスポンスを待たずに複数のリクエストをサーバに送信することができるようになった。
サーバはリクエストを受信した順番にレスポンスをクライアントに送信する。

### チャンク転送

サーバがリソースの送信開始時に`Content-Length`を見つけられない時にリソースをチャンクごとに送信する。
すべてのチャンクを送信し終わると、クライアントに全てのチャンクの送信が完了したことを伝えるためにカラチャンクを送信する。
空のチャンクを送信するときは、レスポンスヘッダーに`Transfer-Encoding: chunked`を含めて送信する。

### 認証

HTTP/1.0では、Basic認証だけだったが、ダイジェスト認証とプロキシ認証も追加された。

その他にも以下のような変更点がある

- キャッシング
- Byte Range
- Character sets
- Language negotiation
- Client cookies
- 圧縮サポートの強化
- 新しいステータスコードの追加

しかし、Webの進化に伴いリソースが大きくなると、サイズの大きいリソースや、低速通信のリソースが、それより後のリクエストをブロックするようになってしまった。

## HTTP/2.0

HTTP/2.0の大きな目的は通信の高速化を行うこと。
主に以下のような変更が行われている。

- バイナリデータでの通信
- 単一接続で複数の非同期HTTPリクエストの実行
- HPACKを使用したヘッダの圧縮
- 単一リクエストに対する複数の応答
- リクエストの優先樹に
- 安全

## HTTP/3.0
